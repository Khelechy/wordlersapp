@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject IJSRuntime Js

<MudThemeProvider @bind-IsDarkMode="@_isDarkTheme" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout >
    @{
        if (ShowAppBar())
        {
            <AppLayout/>
        }
    }
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.False">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    bool _drawerOpen = true;

    bool _isDarkTheme = true;

    bool ShowAppBar()
    {
        var page = NavigationManager.Uri.Substring(NavigationManager.BaseUri.Length - 1);
        return page.Contains("login") || page.Contains("register") ? false : true;
    }

    protected async override Task OnInitializedAsync()
    {
        base.OnInitialized();

        var token = await Js.InvokeAsync<string>("sessionStorage.getItem", "token");
        if (string.IsNullOrEmpty(token))
        {
            NavigationManager.NavigateTo($"login}");
        }

    }

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
}
